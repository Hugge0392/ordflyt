Okej – nu kör vi “hård läge” (JS-baserad sticky som inte kan fallera), och fixar roten till problemet: din vänsterkolumn scrollar internt (overflow-auto) → då får sidan ingen längd, och position: sticky har inget att jobba mot. Vi gör två grejer:

1) Låt sidan scrolla i normalt läge

Byt i textcontainern:

- className="... relative overflow-auto"
+ className={`... relative ${readingFocusMode ? 'overflow-auto' : 'overflow-visible'}`}


(dvs. bara overflow-auto i fokusläge – i normalt läge ska det vara overflow-visible så att hela sidan blir hög och kan scrolla.)

2) “Öka styrkan”: Force-fixad panel med JS (fail-safe)

Detta ignorerar alla sticky-quirks och håller panelen fixerad exakt i högerkolumnen när du skrollar.

Lägg till hooks och refs

Placera nära toppen i komponenten:

const rightColRef = useRef<HTMLDivElement | null>(null);
const panelRef = useRef<HTMLDivElement | null>(null);
const [isPanelFixed, setIsPanelFixed] = useState(false);

useEffect(() => {
  const update = () => {
    const col = rightColRef.current;
    const panel = panelRef.current;
    if (!col || !panel) return;

    const rect = col.getBoundingClientRect();
    const panelH = panel.offsetHeight;

    // Panelen blir "fixed" när kolumnens topp nått top-marginalen (16px),
    // och så länge panelen får plats inom kolumnens höjd.
    const shouldFix = rect.top <= 16 && rect.bottom - 16 >= panelH;

    setIsPanelFixed(shouldFix);

    // Håll panelen exakt över kolumnen (vänster & bredd)
    if (shouldFix) {
      panel.style.width = `${rect.width}px`;
      panel.style.left = `${rect.left}px`;
    } else {
      panel.style.width = '';
      panel.style.left = '';
    }
  };

  update();
  window.addEventListener('scroll', update, { passive: true });
  window.addEventListener('resize', update);
  return () => {
    window.removeEventListener('scroll', update);
    window.removeEventListener('resize', update);
  };
}, []);

Byt ut högersidan

Byt din nuvarande wrapper till detta (behåll panelinnehållet oförändrat inuti):

{/* Right column */}
<div ref={rightColRef} className="w-full lg:w-1/3">
  <div
    ref={panelRef}
    style={isPanelFixed ? { position: 'fixed', top: 16, zIndex: 30 } : { position: 'static' }}
  >
    {/* ...panelinnehållet... */}
  </div>
</div>


Det här gör tre saker:

Sidan scrollar (pga ändring 1) → sticky/fixed har något att reagera på.

Panelen blir fixed exakt när högerkolumnens topp nått 16px från viewportens topp.

Panelens bredd & vänsterposition låses mot kolumnen så den inte hoppar vid responsiv layout.

Om du ändå vill testa CSS-sticky igen efter detta, räcker ofta bara ändring 1 (ta bort overflow-auto i normalt läge). Men lösningen ovan med JS är bulldozer-säkert.