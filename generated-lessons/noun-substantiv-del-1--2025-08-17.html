<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Substantiv - del 1 </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 50%, #f59e0b 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .pratbubbla-container {
            width: 100%;
            height: 100vh;
            display: flex;
        }
        
        .text-area {
            width: 75%;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 4rem;
            padding: 2rem;
        }
        
        .speech-bubble-wrapper {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            max-width: 48rem;
            width: 100%;
            border: 4px solid #93c5fd;
        }
        
        .speech-bubble {
            position: relative;
            background: #f3f4f6;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .speech-bubble::after {
            content: '';
            position: absolute;
            right: -8px;
            top: 24px;
            width: 0;
            height: 0;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-left: 8px solid #f3f4f6;
        }
        
        .character-area {
            width: 25%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .character-info {
            text-align: center;
        }
        
        .character-emoji {
            font-size: 8rem;
            margin-bottom: 1rem;
        }
        
        .character-name {
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            font-weight: bold;
            color: #374151;
        }
        
        .text-display {
            font-size: 1.5rem;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .typing-cursor {
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .alternative-button {
            width: 100%;
            text-align: left;
            padding: 1rem;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
        }
        
        .alternative-button:hover {
            background: #f9fafb;
        }
        
        .action-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            margin-right: 0.75rem;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-secondary {
            background: white;
            color: #374151;
            border: 1px solid #d1d5db;
        }
        
        .btn-secondary:hover {
            background: #f9fafb;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
    </style>
</head>
<body>
    <div id="lesson-container"></div>
    
    <script>
        // Lesson data embedded
        const lessonData = {
  "title": "Substantiv - del 1 ",
  "moments": [
    {
      "id": "merged1_1755383020389_0",
      "type": "pratbubbla",
      "order": 0,
      "title": "Pratbubbla",
      "config": {
        "items": [
          {
            "id": "item-1",
            "type": "text",
            "order": 1,
            "content": "Hall√• p√• dig, landkrabba!"
          },
          {
            "id": "item-1755375850475",
            "type": "text",
            "order": 2,
            "content": "Jag heter Kapten Matilda och jag styr den h√§r substantivskutan! üè¥‚Äç‚ò†Ô∏è \nAlla p√• mitt skepp √ÑLSKAR substantiv. "
          },
          {
            "id": "item-1755375851635",
            "type": "text",
            "order": 3,
            "content": "Varf√∂r det, tror du? "
          },
          {
            "id": "item-1755375851794",
            "type": "text",
            "order": 4,
            "content": "Jo, vi pirater gillar saker mer √§n allt annat ‚Äì och substantiv och saker h√∂r ihop som kniv och gaffel! "
          },
          {
            "id": "item-1755375851964",
            "type": "text",
            "order": 5,
            "content": "Vad √§r d√• ett substantiv?\n\nEtt substantiv √§r ett ord som ber√§ttar vad saker, personer, djur, platser eller k√§nslor heter. Jag heter till exempel Matilda och mitt namn √§r ett substantiv. Jag har ocks√• en hatt p√• mig och det √§r ocks√• ett ord som √§r ett substantiv. "
          },
          {
            "id": "item-1755375852121",
            "type": "text",
            "order": 6,
            "content": "Andra exempel p√• substantiv kan vara:\n\nSaker: boll, bord, dator \n\nPersoner: Erik, Matilda, Tomas\n\nDjur: katt, ko, fisk, papegoja\n\nPlatser: Stockholm, skogen, havet, simhallen\n\nK√§nslor: gl√§dje, k√§rlek, ilska"
          },
          {
            "id": "item-1755375852360",
            "type": "text",
            "order": 7,
            "content": "üëâ Kom ih√•g denna lilla ramsa: \n‚ÄúSubstantiv √§r namn p√• ting, som stol, katt och en ring.‚Äù "
          },
          {
            "id": "item-1755376105582",
            "type": "question",
            "order": 8,
            "content": "F√•r se kommer du ih√•g?\n\nVilket av dessa ord √§r ett substantiv?",
            "alternatives": [
              {
                "text": "Boll",
                "correct": true
              },
              {
                "text": "Simmade",
                "correct": false
              }
            ],
            "correctFeedback": "R√§tt svar: Boll - f√∂r det √§r ju ett namn p√• en sak. Bra d√§r!",
            "incorrectFeedback": "Tyv√§rr fel... Simma √§r ju n√•got man g√∂r och det √§r inte ett substantiv (verb)"
          },
          {
            "id": "item-1755383608528",
            "type": "question",
            "order": 9,
            "content": "Vilket ord √§r substantivet",
            "alternatives": [
              {
                "text": "Kanske",
                "correct": false
              },
              {
                "text": "N√§r",
                "correct": false
              },
              {
                "text": "Bok",
                "correct": true
              },
              {
                "text": "Usch!",
                "correct": false
              }
            ],
            "correctFeedback": "R√§tt! Bra jobbat!",
            "incorrectFeedback": "Fel svar. F√∂rs√∂k igen!"
          },
          {
            "id": "item-1755376261972",
            "type": "text",
            "order": 10,
            "content": "Nu verkar du f√• lite koll, eller som vi s√§ger \"f√• sj√∂ben\". \n\nJag har b√•de en katt och en papegoja. B√•da √§r v√§ldigt trevliga! üê±ü¶ú\nNamn p√• djur √§r ocks√• substantiv.\n\nExempel:\n\nKatt, ko, √•sna, kamel, fj√§ril, fisk."
          },
          {
            "id": "item-1755384675065",
            "type": "question",
            "order": 11,
            "content": "Vad √§r substantivet i denna mening?\n\nAj! Min katt bet mig!",
            "alternatives": [
              {
                "text": "Aj!",
                "correct": false
              },
              {
                "text": "Min",
                "correct": false
              },
              {
                "text": "Katt",
                "correct": true
              },
              {
                "text": "Bet",
                "correct": false
              },
              {
                "text": "Mig",
                "correct": false
              }
            ],
            "correctFeedback": "R√§tt! Bra jobbat!",
            "incorrectFeedback": "Fel svar. F√∂rs√∂k igen!"
          },
          {
            "id": "item-1755384729408",
            "type": "question",
            "order": 12,
            "content": "Vad √§r substantivet i denna mening?\n\nKr√§ftan l√•g bara d√§r",
            "alternatives": [
              {
                "text": "Kr√§ftan",
                "correct": true
              },
              {
                "text": "L√•g",
                "correct": false
              },
              {
                "text": "Bara",
                "correct": false
              },
              {
                "text": "D√§r",
                "correct": false
              }
            ],
            "correctFeedback": "R√§tt! Bra jobbat!",
            "incorrectFeedback": "Fel svar. F√∂rs√∂k igen!"
          }
        ],
        "animationSpeed": 25,
        "characterImage": "/@fs/home/runner/workspace/attached_assets/Pirat%20h%C3%B6ger_1755326212023.png"
      }
    },
    {
      "id": "merged1_1755383020389_1",
      "type": "pratbubbla",
      "order": 1,
      "title": "Pratbubbla",
      "config": {
        "items": [
          {
            "id": "item-1",
            "type": "text",
            "order": 1,
            "content": "Topp! Nu har du koll p√• att namn b√•de levande varelser och saker √§r substantiv. \n\nDet finns √§ven andra grejer som √§r substantiv. \n\nAlla namn p√• m√§nniskor √§r substantiv: Erik, Sara, Greta, Kondrad, Matilda\n\n√Ñven alla namn p√• platser √§r substantiv: Simhallen, Malm√∂, men √§ven ord som skogen och havet. "
          },
          {
            "id": "item-1755384109366",
            "type": "text",
            "order": 4,
            "content": "Jag kanske kommer fr√•n S√∂derhavet och du fr√•n n√•gon helt annan plats.\nMen en sak √§r s√§ker: namnet p√• en plats √§r alltid ett substantiv!\n\nExempel p√• st√§der:\nStockholm\nG√§vle\nFalun\n\nMen √§ven mindre st√§llen √§r ocks√• exempel p√• substantiv:\nRidhuset\nSimhallen\nGretas grill"
          },
          {
            "id": "item-1755383941466",
            "type": "question",
            "order": 5,
            "content": "Vilket ord i denna mening √§r ett substantiv?\n\nVi √•kte till G√∂teborg",
            "alternatives": [
              {
                "text": "Vi",
                "correct": false
              },
              {
                "text": "√Ökte",
                "correct": false
              },
              {
                "text": "Till",
                "correct": false
              },
              {
                "text": "G√∂teborg",
                "correct": true
              }
            ],
            "correctFeedback": "R√§tt! Bra jobbat!",
            "incorrectFeedback": "Fel svar. F√∂rs√∂k igen!"
          },
          {
            "id": "item-1755384018937",
            "type": "question",
            "order": 6,
            "content": "Vilket ord i denna mening √§r ett substantiv?\n\nNej! Ridhuset har st√§ngt",
            "alternatives": [
              {
                "text": "Nej!",
                "correct": false
              },
              {
                "text": "Ridhuset",
                "correct": true
              },
              {
                "text": "Har",
                "correct": false
              },
              {
                "text": "St√§ngt",
                "correct": false
              }
            ],
            "correctFeedback": "R√§tt! Bra jobbat!",
            "incorrectFeedback": "Fel svar. F√∂rs√∂k igen!"
          },
          {
            "id": "item-1755377657324",
            "type": "text",
            "order": 7,
            "content": "Nu ska vi se ifall du kan gr√§va upp ett par skatter som jag har g√∂mt... "
          }
        ],
        "animationSpeed": 25,
        "characterImage": "/@fs/home/runner/workspace/attached_assets/Pirat%20h%C3%B6ger_1755326212023.png"
      }
    },
    {
      "id": "merged1_1755383020389_2",
      "type": "piratgrav",
      "order": 2,
      "title": "Piratgr√§v",
      "config": {
        "words": [
          {
            "n": true,
            "w": "Matilda"
          },
          {
            "n": false,
            "w": "Springa"
          },
          {
            "n": true,
            "w": "Stockholm"
          },
          {
            "n": false,
            "w": "R√∂d"
          },
          {
            "n": true,
            "w": "Tomas"
          },
          {
            "n": false,
            "w": "Sn√§ll"
          },
          {
            "n": true,
            "w": "Katt"
          },
          {
            "n": false,
            "w": "Gr√∂n"
          },
          {
            "n": true,
            "w": "B√∂cker"
          },
          {
            "n": false,
            "w": "D√•lig"
          },
          {
            "n": true,
            "w": "Simhall"
          },
          {
            "n": false,
            "w": "Eller"
          }
        ],
        "instruction": "Gr√§v fram ord och avg√∂r om de √§r substantiv"
      }
    },
    {
      "id": "merged1_1755383020389_3",
      "type": "pratbubbla",
      "order": 3,
      "title": "Pratbubbla",
      "config": {
        "items": [
          {
            "id": "item-1",
            "type": "text",
            "order": 1,
            "content": "Jag m√•r lite d√•ligt... Det k√§nns som jag h√•ller p√• att bli sj√∂sjuk!\nSj√∂sjuka √§r en obehaglig k√§nsla ‚Äì och namn p√• k√§nslor √§r ocks√• substantiv."
          },
          {
            "id": "item-1755379557807",
            "type": "text",
            "order": 2,
            "content": "K√§nslor som gl√§dje, ilska, k√§rlek, illam√•ende, h√•ll och tandv√§rk √§r ocks√• substantiv."
          },
          {
            "id": "item-1755384876559",
            "type": "question",
            "order": 3,
            "content": "Vilket ord √§r ett substantiv\n\nGl√§djen fyllde hela rummet.",
            "alternatives": [
              {
                "text": "Gl√§djen",
                "correct": true
              },
              {
                "text": "Fyllde",
                "correct": false
              },
              {
                "text": "Hela",
                "correct": false
              },
              {
                "text": "rummet",
                "correct": false
              }
            ],
            "correctFeedback": "R√§tt! Bra jobbat!",
            "incorrectFeedback": "Fel svar. F√∂rs√∂k igen!"
          },
          {
            "id": "item-1755384960258",
            "type": "question",
            "order": 4,
            "content": "Vilket ord √§r ett substantiv\n\nHan fylldes av ilska",
            "alternatives": [
              {
                "text": "Han",
                "correct": false
              },
              {
                "text": "Fylldes",
                "correct": false
              },
              {
                "text": "Av",
                "correct": false
              },
              {
                "text": "Ilska",
                "correct": true
              }
            ],
            "correctFeedback": "R√§tt! Bra jobbat!",
            "incorrectFeedback": "Fel svar. F√∂rs√∂k igen!"
          },
          {
            "id": "item-1755379699695",
            "type": "text",
            "order": 5,
            "content": "Toppenbra jobbat! Nu har det √§ntligen dags f√∂r ditt slutprov!"
          }
        ],
        "animationSpeed": 25,
        "characterImage": "/@fs/home/runner/workspace/attached_assets/Pirat%20h%C3%B6ger_1755326212023.png"
      }
    },
    {
      "id": "merged2_1755383020389_4",
      "type": "slutprov",
      "order": 4,
      "title": "Slutprov",
      "config": {
        "sentences": [
          "Jag har en anka",
          "Min nya bil vill inte starta",
          "Titta en skog!",
          "Solstolen v√§lte genast",
          "Kalmar vann inte ig√•r",
          "Jag spillde p√• mina byxor!",
          "Gl√§djen sprider sig",
          "Frankrike √§r fint",
          "Inska √§r tr√•kigt",
          "Zebran sprang iv√§g",
          "Spring Jonas, spring!",
          "Se p√• havet!",
          "Min katt √§r den finaste!",
          "Jag har k√∂pt en ny cykel",
          "K√§rlek √§r fint"
        ],
        "timeLimit": 120,
        "instruction": "Klicka p√• substantivet i meningen",
        "targetWords": [
          "anka",
          "bil",
          "skog!",
          "Solstolen",
          "Kalmar",
          "byxor!",
          "Gl√§djen",
          "Frankrike",
          "Ilska",
          "Zebran",
          "Jonas",
          "Havet",
          "katt",
          "Cykel",
          "K√§rlek"
        ],
        "penaltySeconds": 10,
        "requiredCorrect": 12
      }
    },
    {
      "id": "moment_1755411742452",
      "type": "slutdiplom",
      "order": 5,
      "title": "Slutdiplom",
      "config": {
        "courseName": "Substantiv - del 1 "
      }
    }
  ],
  "wordClass": "noun",
  "background": "beach"
};
        
        class LessonPlayer {
            constructor() {
                this.currentMomentIndex = 0;
                this.currentText = "";
                this.textIndex = 0;
                this.currentItemIndex = 0;
                this.itemCompleted = false;
                this.showFeedback = false;
                this.feedbackText = '';
                this.selectedAnswer = null;
                this.typewriterInterval = null;
                
                this.container = document.getElementById('lesson-container');
                this.render();
                this.startTypewriter();
            }
            
            getCurrentMoment() {
                return lessonData.moments[this.currentMomentIndex];
            }
            
            getCurrentItem() {
                const moment = this.getCurrentMoment();
                if (moment?.type === 'pratbubbla' && moment.config.items && moment.config.items.length > 0) {
                    const sortedItems = [...moment.config.items].sort((a, b) => a.order - b.order);
                    return sortedItems[this.currentItemIndex] || null;
                }
                return null;
            }
            
            startTypewriter() {
                this.clearTypewriter();
                const moment = this.getCurrentMoment();
                if (moment?.type === 'pratbubbla') {
                    const currentItem = this.getCurrentItem();
                    let text = '';
                    
                    if (currentItem && (currentItem.type === 'text' || currentItem.type === 'question')) {
                        text = currentItem.content || '';
                    } else if (!moment.config.items) {
                        text = moment.config.text || '';
                    }
                    
                    if (text) {
                        this.textIndex = 0;
                        this.currentText = '';
                        this.itemCompleted = false;
                        const speed = moment.config.animationSpeed || 50;
                        
                        this.typewriterInterval = setInterval(() => {
                            if (this.textIndex < text.length) {
                                this.currentText = text.slice(0, this.textIndex + 1);
                                this.textIndex++;
                                this.updateTextDisplay();
                            } else {
                                this.itemCompleted = true;
                                this.clearTypewriter();
                                this.render();
                            }
                        }, speed);
                    }
                }
            }
            
            clearTypewriter() {
                if (this.typewriterInterval) {
                    clearInterval(this.typewriterInterval);
                    this.typewriterInterval = null;
                }
            }
            
            updateTextDisplay() {
                const textElement = document.getElementById('text-display');
                if (textElement) {
                    textElement.innerHTML = this.currentText + (this.itemCompleted ? '' : '<span class="typing-cursor">|</span>');
                }
            }
            
            handleAnswerSelect(answer, isCorrect) {
                this.selectedAnswer = answer;
                this.showFeedback = true;
                
                const currentItem = this.getCurrentItem();
                if (isCorrect) {
                    this.feedbackText = currentItem?.correctFeedback || 'R√§tt! Bra jobbat!';
                } else {
                    this.feedbackText = currentItem?.incorrectFeedback || 'Fel svar. F√∂rs√∂k igen!';
                }
                this.render();
            }
            
            resetQuestion() {
                this.selectedAnswer = null;
                this.showFeedback = false;
                this.feedbackText = '';
                this.render();
            }
            
            goToNextItem() {
                const moment = this.getCurrentMoment();
                if (moment.config.items && moment.config.items.length > 0) {
                    const sortedItems = [...moment.config.items].sort((a, b) => a.order - b.order);
                    if (this.currentItemIndex < sortedItems.length - 1) {
                        this.currentItemIndex++;
                        this.render();
                        this.startTypewriter();
                    } else {
                        this.goToNextMoment();
                    }
                } else {
                    this.goToNextMoment();
                }
            }
            
            goToNextMoment() {
                if (this.currentMomentIndex < lessonData.moments.length - 1) {
                    this.currentMomentIndex++;
                    this.currentItemIndex = 0;
                    this.showFeedback = false;
                    this.selectedAnswer = null;
                    this.render();
                    this.startTypewriter();
                }
            }
            
            isLastItem() {
                const moment = this.getCurrentMoment();
                if (moment?.type === 'pratbubbla' && moment.config.items && moment.config.items.length > 0) {
                    const sortedItems = [...moment.config.items].sort((a, b) => a.order - b.order);
                    return this.currentItemIndex === sortedItems.length - 1;
                }
                return false;
            }
            
            render() {
                const moment = this.getCurrentMoment();
                
                if (!moment) {
                    this.container.innerHTML = `
                        <div class="flex items-center justify-center h-screen text-2xl">
                            Lektion slutf√∂rd! üéâ
                        </div>
                    `;
                    return;
                }
                
                if (moment.type === 'pratbubbla') {
                    const currentItem = this.getCurrentItem();
                    const isCurrentItemQuestion = currentItem?.type === 'question';
                    const isCurrentItemText = currentItem?.type === 'text';
                    
                    let hasQuestion = false;
                    let currentAlternatives = [];
                    
                    if (isCurrentItemQuestion) {
                        hasQuestion = true;
                        currentAlternatives = currentItem?.alternatives || [];
                    } else if (!moment.config.items && moment.config.question && moment.config.alternatives) {
                        hasQuestion = true;
                        currentAlternatives = moment.config.alternatives || [];
                    }
                    
                    const textComplete = (isCurrentItemText || isCurrentItemQuestion) ? this.itemCompleted : true;
                    
                    this.container.innerHTML = `
                        <div class="pratbubbla-container">
                            <div class="text-area">
                                <div class="speech-bubble-wrapper">
                                    <div class="speech-bubble">
                                        <div id="text-display" class="text-display">
                                            ${this.showFeedback ? this.feedbackText : this.currentText}${!this.showFeedback && !this.itemCompleted ? '<span class="typing-cursor">|</span>' : ''}
                                        </div>
                                        
                                        ${hasQuestion && isCurrentItemQuestion && textComplete && !this.showFeedback ? `
                                            <div style="margin-top: 1.5rem;">
                                                ${currentAlternatives.map((alt, index) => `
                                                    <button class="alternative-button" onclick="player.handleAnswerSelect('${alt.text}', ${alt.correct})">
                                                        ${alt.text}
                                                    </button>
                                                `).join('')}
                                            </div>
                                        ` : ''}
                                        
                                        ${this.showFeedback ? `
                                            <div style="margin-top: 1rem;">
                                                ${!currentAlternatives.find(alt => alt.text === this.selectedAnswer)?.correct ? `
                                                    <button class="action-button btn-secondary" onclick="player.resetQuestion()">F√∂rs√∂k igen</button>
                                                ` : `
                                                    <button class="action-button btn-primary" onclick="player.${this.isLastItem() ? 'goToNextMoment' : 'goToNextItem'}()">
                                                        ${this.isLastItem() ? 'Slutf√∂r momentet' : 'N√§sta'}
                                                    </button>
                                                `}
                                            </div>
                                        ` : ''}
                                        
                                        ${!hasQuestion && this.itemCompleted && !this.isLastItem() ? `
                                            <div style="margin-top: 1rem;">
                                                <button class="action-button btn-primary" onclick="player.goToNextItem()">Forts√§tt</button>
                                            </div>
                                        ` : ''}
                                        
                                        ${!hasQuestion && this.itemCompleted && this.isLastItem() ? `
                                            <div style="margin-top: 1rem;">
                                                <button class="action-button btn-success" onclick="player.goToNextMoment()">Slutf√∂r momentet</button>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="character-area">
                                <div class="character-info">
                                    <div class="character-emoji">üè¥‚Äç‚ò†Ô∏è</div>
                                    <div class="character-name">
                                        ${moment.config.characterName || 'Kapten Matilda'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    this.container.innerHTML = `
                        <div style="padding: 2rem;">
                            <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem;">${moment.title}</h2>
                            <p>Moment typ: ${moment.type}</p>
                            <button class="action-button btn-primary" onclick="player.goToNextMoment()" style="margin-top: 1rem;">N√§sta moment</button>
                        </div>
                    `;
                }
            }
        }
        
        // Start the lesson player
        const player = new LessonPlayer();
    </script>
</body>
</html>