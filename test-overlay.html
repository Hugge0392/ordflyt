<!DOCTYPE html>
<html>
<head>
    <title>Test Global Overlay</title>
    <style>
        body { margin: 0; padding: 20px; }
        .content { height: 200vh; background: linear-gradient(to bottom, #ff0000, #00ff00, #0000ff); }
        .focus-area { 
            position: absolute; 
            top: 300px; 
            left: 100px; 
            width: 400px; 
            height: 100px; 
            background: white; 
            border: 2px solid black; 
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="content">
        <div class="focus-area">
            <h2>This should be visible through the hole</h2>
            <p>Everything else should be dark</p>
        </div>
    </div>
    
    <button onclick="toggleOverlay()" style="position: fixed; top: 10px; right: 10px; z-index: 999999999;">
        Toggle Overlay
    </button>
    
    <script>
        let overlayActive = false;
        
        function toggleOverlay() {
            if (overlayActive) {
                const overlay = document.getElementById('global-overlay');
                if (overlay) overlay.remove();
                overlayActive = false;
            } else {
                const focusRect = { left: 100, top: 300, width: 400, height: 100 };
                
                const overlay = document.createElement('div');
                overlay.id = 'global-overlay';
                overlay.style.cssText = `
                    position: fixed;
                    inset: 0;
                    z-index: 2147483646;
                    pointer-events: none;
                `;
                
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('width', '100%');
                svg.setAttribute('height', '100%');
                svg.setAttribute('viewBox', `0 0 ${window.innerWidth} ${window.innerHeight}`);
                svg.style.cssText = 'position: fixed; inset: 0; display: block;';
                
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', `
                    M 0 0 H ${window.innerWidth} V ${window.innerHeight} H 0 Z
                    M ${Math.max(0, focusRect.left)} ${Math.max(0, focusRect.top)}
                      H ${Math.min(window.innerWidth, focusRect.left + focusRect.width)}
                      V ${Math.min(window.innerHeight, focusRect.top + focusRect.height)}
                      H ${Math.max(0, focusRect.left)}
                      Z
                `);
                path.setAttribute('fill', 'rgba(0,0,0,0.88)');
                path.setAttribute('fill-rule', 'evenodd');
                
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', focusRect.left);
                rect.setAttribute('y', focusRect.top);
                rect.setAttribute('width', focusRect.width);
                rect.setAttribute('height', focusRect.height);
                rect.setAttribute('fill', 'none');
                rect.setAttribute('stroke', 'white');
                rect.setAttribute('stroke-width', '2');
                rect.setAttribute('rx', '4');
                rect.setAttribute('ry', '4');
                
                svg.appendChild(path);
                svg.appendChild(rect);
                overlay.appendChild(svg);
                document.body.appendChild(overlay);
                
                overlayActive = true;
            }
        }
    </script>
</body>
</html>